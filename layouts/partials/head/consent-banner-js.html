<script>
    function getConsent() {
        return JSON.parse(localStorage.getItem('consentSettings') || '{}');
    }

    function saveConsent() {
        const settings = {
            analytics: document.getElementById('consent-analytics').checked,
        };
        localStorage.setItem('consentSettings', JSON.stringify(settings));
        document.getElementById('consent-banner').style.display = 'none';
        applyConsent(settings);
    }

    function resetConsent() {
        localStorage.removeItem('consentSettings');
        location.reload();
    }

    function applyConsent(settings) {
        if (settings.analytics) {
            loadMatomo();
        }
    }

    function loadMatomo() {
        var _paq = window._paq = window._paq || [];
        /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
        _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
        _paq.push(["setCookieDomain", "*.innoviter.com"]);
        _paq.push(["disableCookies"]);
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        (function() {
            var u="//analytics.innv.it/";
            _paq.push(['setTrackerUrl', u+'matomo.php']);
            _paq.push(['setSiteId', '1']);
            var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
            g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
        })();
    }

    window.addEventListener('DOMContentLoaded', () => {
        const consent = getConsent();
        if (Object.keys(consent).length === 0) {
            document.getElementById('consent-banner').style.display = 'block';
        } else {
            applyConsent(consent);
        }
    });
</script>